<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-4 flex-col md:flex-row">
    <div>
      <h2 class="text-2xl font-bold">Hello {{ username }} !</h2>
      <p class="text-gray-500">Time: {{ currentTime }}</p>
    </div>
    <button
      mat-raised-button
      color="primary"
      class="mb-4 md:mt-auto mt-4 !p-6 rounded-btn"
      (click)="openGenerateSurveyDialog()"
    >
      <mat-icon class="mr-2"> emoji_objects</mat-icon>
      AI Generate
    </button>

    <button
      mat-raised-button
      color="primary"
      class="mb-4 rounded-btn !p-6"
      (click)="createNewSurvey()"
    >
      <mat-icon class="mr-2">post_add</mat-icon>
      New Survey
    </button>
  </div>

  <ng-container *ngIf="surveysLoaded; else loading">
    <!-- Check if surveys are present -->
    <ng-container *ngIf="(surveys$ | async)?.length; else noSurveys">
      <ng-container *ngIf="surveys$ | async as surveys">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
          <div *ngFor="let survey of surveys" class="survey-item">
            <div class="flex flex-col items-center justify-center">
              <mat-icon
                class="text-8xl mb-2 h-auto w-auto survey-icon"
                (click)="navigateToSurvey(survey.id)"
                >description</mat-icon
              >
              <div
                class="text-lg font-bold text-gray-800 mb-2 text-center"
                (click)="navigateToSurvey(survey.id)"
              >
                {{ survey.title }}
              </div>
              <div class="flex justify-between items-center text-cyan-900">
                <button
                  class="item-button"
                  mat-icon-button
                  (click)="navigateToViewSurvey(survey.id)"
                  title="View Survey"
                >
                  <mat-icon>remove_red_eye</mat-icon>
                </button>
                <button
                  class="item-button"
                  mat-icon-button
                  (click)="navigateToSurveyResponses(survey.id)"
                  title="Responses and Analytics"
                >
                  <mat-icon>analytics</mat-icon>
                </button>
                <button
                  class="item-button"
                  mat-icon-button
                  [matMenuTriggerFor]="menu"
                  aria-label="Survey Options"
                >
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button
                    class="item-button"
                    mat-menu-item
                    (click)="navigateToViewSurvey(survey.id)"
                  >
                    <mat-icon>remove_red_eye</mat-icon>
                    <span>View Survey</span>
                  </button>
                  <button
                    class="item-button"
                    mat-menu-item
                    (click)="navigateToSurvey(survey.id)"
                  >
                    <mat-icon>edit</mat-icon>
                    <span>Edit Survey</span>
                  </button>
                  <button
                    class="item-button"
                    mat-menu-item
                    (click)="navigateToSurveyResponses(survey.id)"
                  >
                    <mat-icon>analytics</mat-icon>
                    <span>Survey Analytics</span>
                  </button>
                  <button class="item-button" mat-menu-item>
                    <mat-icon>group</mat-icon>
                    <span>Access Roles</span>
                  </button>
                  <button
                    class="item-button"
                    mat-menu-item
                    (click)="deleteSurvey(survey.id)"
                  >
                    <mat-icon color="warn">delete</mat-icon>
                    <span>Delete Survey</span>
                  </button>
                </mat-menu>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>
</div>

<ng-template #loading>
  <div class="flex justify-center items-center h-screen">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>

<ng-template #noSurveys>
  <div class="flex flex-col items-center justify-center h-72">
    <p class="text-2xl mb-4">No surveys found.</p>
    <button
      mat-raised-button
      color="secondary"
      class="mb-4 px-6 py-2 bg-blue-500 text-white rounded-md text-4xl"
      (click)="createNewSurvey()"
    >
      <mat-icon class="mr-2">post_add</mat-icon>
      Create Your First Survey
    </button>
  </div>
</ng-template>
